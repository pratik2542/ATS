(()=>{"use strict";async function e(e,n,t="openai"){return"gemini"===t?await async function(e,n){const t=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:e}]}]})});if(!t.ok){const e=await t.json();throw new Error(`Gemini API error: ${e.error?.message||t.statusText}`)}return(await t.json()).candidates[0].content.parts[0].text}(e,n):await async function(e,n){const t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:"gpt-4-turbo-preview",messages:[{role:"system",content:"You are an expert ATS system and career advisor. Provide precise, actionable advice."},{role:"user",content:e}],temperature:.7,max_tokens:2e3})});if(!t.ok)throw new Error(`OpenAI API error: ${t.statusText}`);return(await t.json()).choices[0].message.content}(e,n)}chrome.runtime.onInstalled.addListener(()=>{console.log("ATS Resume Tracker installed"),chrome.storage.local.get(["resumes"],e=>{e.resumes||chrome.storage.local.set({resumes:[],jobs:[],applications:[],coverLetters:[],optimizedResumes:[]})})}),chrome.runtime.onMessage.addListener((n,t,r)=>{switch(console.log("Background received message:",n),n.type){case"EXTRACT_JOB":return async function(e,n){try{const t=e.job;chrome.storage.local.get(["jobs"],e=>{const r=e.jobs||[],s=r.findIndex(e=>e.url===t.url);s>=0?r[s]=t:r.push(t),chrome.storage.local.set({jobs:r},()=>{n({success:!0,job:t})})})}catch(e){n({success:!1,error:e.message})}}(n.payload,r),!0;case"ANALYZE_RESUME":return async function(n,t){try{const{resume:r,job:s,apiKey:a,provider:o}=n,i=await async function(n,t,r,s){const a=`You are an ATS (Applicant Tracking System) expert. Analyze the following resume against the job description and provide detailed feedback.\n\nResume:\n${n.parsedText}\n\nJob Description:\n${t.description}\n\nProvide your analysis in the following JSON format:\n{\n  "score": <number 0-100>,\n  "matchedKeywords": [<array of matched keywords from job description>],\n  "missingKeywords": [<array of important keywords missing from resume>],\n  "matchedSkills": [<array of matched skills>],\n  "missingSkills": [<array of missing skills that are required>],\n  "suggestions": [<array of specific actionable suggestions to improve the resume>],\n  "sections": [\n    {\n      "name": "<section name like Experience, Skills, Education>",\n      "score": <number 0-100>,\n      "feedback": "<specific feedback for this section>"\n    }\n  ]\n}`;let o=await e(a,r,s);return o=o.replace(/^```json\n?/,"").replace(/\n?```$/,"").trim(),JSON.parse(o)}(r,s,a,o);t({success:!0,analysis:i})}catch(e){t({success:!1,error:e.message})}}(n.payload,r),!0;case"GENERATE_RESUME":return async function(n,t){try{const{resume:r,job:s,analysis:a,apiKey:o,provider:i}=n,c=await async function(n,t,r,s,a){const o=`You are an expert resume writer. Based on the analysis below, modify the resume to better match the job description while keeping the core information truthful.\n\nOriginal Resume:\n${n.parsedText}\n\nJob Description:\n${t.description}\n\nAnalysis:\n${JSON.stringify(r,null,2)}\n\nInstructions:\n1. Add missing keywords naturally where appropriate\n2. Highlight relevant experience that matches job requirements\n3. Reorganize or rephrase bullet points to emphasize matching skills\n4. Keep all information truthful - only rephrase, don't fabricate\n5. Maintain professional formatting\n\nProvide the optimized resume content as plain text.`;return await e(o,s,a)}(r,s,a,o,i);t({success:!0,optimizedResume:c})}catch(e){t({success:!1,error:e.message})}}(n.payload,r),!0;case"GENERATE_COVER_LETTER":return async function(n,t){try{const{resume:r,job:s,apiKey:a,provider:o}=n,i=await async function(n,t,r,s){const a=`You are an expert cover letter writer. Create a compelling, personalized cover letter for this job application.\n\nResume Summary:\n${n.parsedText.substring(0,1e3)}\n\nJob Title: ${t.title}\nCompany: ${t.company}\nJob Description:\n${t.description}\n\nInstructions:\n1. Create a professional cover letter (3-4 paragraphs)\n2. Highlight relevant experience from the resume\n3. Show enthusiasm for the role and company\n4. Explain why the candidate is a great fit\n5. Use a professional but warm tone\n6. Keep it concise (under 400 words)\n\nProvide only the cover letter content without any additional commentary.`;return await e(a,r,s)}(r,s,a,o);t({success:!0,coverLetter:i})}catch(e){t({success:!1,error:e.message})}}(n.payload,r),!0;case"GET_CURRENT_TAB":return chrome.tabs.query({active:!0,currentWindow:!0},e=>{r({url:e[0]?.url})}),!0}})})();