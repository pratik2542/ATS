(()=>{"use strict";console.log("ATS Resume Tracker content script loaded");let n=null;function e(n){try{const e=new URL(n).hostname.split(".");if(e.length>=2)return e[e.length-2].charAt(0).toUpperCase()+e[e.length-2].slice(1)}catch(n){console.error("Error extracting company from URL:",n)}return"Unknown Company"}chrome.runtime.onMessage.addListener((t,s,o)=>("REQUEST_JOB_EXTRACTION"===t.type?o({success:!0,job:function(){const n=window.location.href;let t="",s="",o="";const i=['h1[class*="job"]','h1[class*="title"]','[class*="job-title"]','[class*="jobTitle"]','[data-testid*="job-title"]',"h1",".job-details-jobs-unified-top-card__job-title",".jobs-unified-top-card__job-title"];for(const n of i){const e=document.querySelector(n);if(e&&e.textContent?.trim()){t=e.textContent.trim();break}}const a=['[class*="company"]','[class*="employer"]','[data-testid*="company"]',".job-details-jobs-unified-top-card__company-name",".jobs-unified-top-card__company-name",'a[class*="company"]'];for(const n of a){const e=document.querySelector(n);if(e&&e.textContent?.trim()){s=e.textContent.trim();break}}const r=['[class*="description"]','[class*="job-description"]','[class*="jobDescription"]','[id*="job-description"]','[id*="jobDescription"]',".jobs-description",".show-more-less-html__markup","article","main"];for(const n of r){const e=document.querySelector(n);if(e){let n=e.textContent||"";if(n=n.replace(/\s+/g," ").trim(),n.length>100){o=n;break}}}return o||(o=document.body.innerText.replace(/\s+/g," ").trim()),{id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,title:t||"Unknown Position",company:s||e(n),description:o,url:n,extractedDate:Date.now()}}()}):"SHOW_ANALYSIS_PANEL"===t.type&&(function(e){n&&n.remove(),n=document.createElement("div"),n.id="ats-analysis-panel",n.innerHTML=`\n    <div class="ats-panel-header">\n      <h3>ATS Analysis Results</h3>\n      <button class="ats-close-btn">&times;</button>\n    </div>\n    <div class="ats-panel-content">\n      <div class="ats-score">\n        <div class="score-circle" style="background: conic-gradient(#4CAF50 ${3.6*e.analysis.score}deg, #e0e0e0 0deg)">\n          <div class="score-inner">\n            <span class="score-number">${e.analysis.score}</span>\n            <span class="score-label">ATS Score</span>\n          </div>\n        </div>\n      </div>\n      \n      <div class="ats-section">\n        <h4>âœ“ Matched Keywords (${e.analysis.matchedKeywords.length})</h4>\n        <div class="keyword-list matched">\n          ${e.analysis.matchedKeywords.map(n=>`<span class="keyword">${n}</span>`).join("")}\n        </div>\n      </div>\n      \n      <div class="ats-section">\n        <h4>âœ— Missing Keywords (${e.analysis.missingKeywords.length})</h4>\n        <div class="keyword-list missing">\n          ${e.analysis.missingKeywords.map(n=>`<span class="keyword">${n}</span>`).join("")}\n        </div>\n      </div>\n      \n      <div class="ats-section">\n        <h4>ðŸ’¡ Suggestions</h4>\n        <ul class="suggestions-list">\n          ${e.analysis.suggestions.map(n=>`<li>${n}</li>`).join("")}\n        </ul>\n      </div>\n      \n      <div class="ats-actions">\n        <button class="ats-btn primary" id="optimize-resume-btn">Optimize My Resume</button>\n        <button class="ats-btn secondary" id="view-details-btn">View Full Details</button>\n      </div>\n    </div>\n  `;const t=document.createElement("style");t.textContent="\n    #ats-analysis-panel {\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      width: 400px;\n      max-height: 80vh;\n      background: white;\n      border-radius: 12px;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n      z-index: 999999;\n      overflow: hidden;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n    \n    .ats-panel-header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 16px 20px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n    \n    .ats-panel-header h3 {\n      margin: 0;\n      font-size: 18px;\n      font-weight: 600;\n    }\n    \n    .ats-close-btn {\n      background: none;\n      border: none;\n      color: white;\n      font-size: 28px;\n      cursor: pointer;\n      padding: 0;\n      width: 30px;\n      height: 30px;\n      line-height: 1;\n    }\n    \n    .ats-panel-content {\n      padding: 20px;\n      max-height: calc(80vh - 60px);\n      overflow-y: auto;\n    }\n    \n    .ats-score {\n      display: flex;\n      justify-content: center;\n      margin-bottom: 24px;\n    }\n    \n    .score-circle {\n      width: 120px;\n      height: 120px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    \n    .score-inner {\n      width: 100px;\n      height: 100px;\n      background: white;\n      border-radius: 50%;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n    }\n    \n    .score-number {\n      font-size: 32px;\n      font-weight: bold;\n      color: #333;\n    }\n    \n    .score-label {\n      font-size: 12px;\n      color: #666;\n    }\n    \n    .ats-section {\n      margin-bottom: 20px;\n    }\n    \n    .ats-section h4 {\n      font-size: 14px;\n      font-weight: 600;\n      margin: 0 0 10px 0;\n      color: #333;\n    }\n    \n    .keyword-list {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 6px;\n    }\n    \n    .keyword {\n      padding: 4px 10px;\n      border-radius: 16px;\n      font-size: 12px;\n      font-weight: 500;\n    }\n    \n    .keyword-list.matched .keyword {\n      background: #e8f5e9;\n      color: #2e7d32;\n    }\n    \n    .keyword-list.missing .keyword {\n      background: #ffebee;\n      color: #c62828;\n    }\n    \n    .suggestions-list {\n      margin: 0;\n      padding-left: 20px;\n    }\n    \n    .suggestions-list li {\n      font-size: 13px;\n      color: #555;\n      margin-bottom: 8px;\n      line-height: 1.5;\n    }\n    \n    .ats-actions {\n      display: flex;\n      gap: 10px;\n      margin-top: 20px;\n    }\n    \n    .ats-btn {\n      flex: 1;\n      padding: 12px;\n      border: none;\n      border-radius: 8px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n    \n    .ats-btn.primary {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n    }\n    \n    .ats-btn.primary:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n    }\n    \n    .ats-btn.secondary {\n      background: white;\n      color: #667eea;\n      border: 2px solid #667eea;\n    }\n    \n    .ats-btn.secondary:hover {\n      background: #f5f7ff;\n    }\n  ",document.head.appendChild(t),document.body.appendChild(n);const s=n.querySelector(".ats-close-btn");s?.addEventListener("click",()=>{n?.remove()});const o=n.querySelector("#optimize-resume-btn");o?.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"OPEN_OPTIMIZATION",payload:e})});const i=n.querySelector("#view-details-btn");i?.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"OPEN_FULL_ANALYSIS",payload:e})})}(t.payload),o({success:!0})),!0))})();